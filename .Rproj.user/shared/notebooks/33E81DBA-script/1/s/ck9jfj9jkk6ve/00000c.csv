"0","set.seed(123)
tripdata %>%
  slice_sample(n=150000) %>%
  drop_na() %>%
  mutate(date = lubridate::as_date(started_at),
         ym = str_extract(date, pattern = '^[0-9]{4}-[0-9]{2}')) %>%
  count(start_station_id, member_casual, ym) %>%
  pivot_wider(names_from = member_casual, values_from = n, values_fill = 0) %>%
  mutate(total = casual+member) %>% 
  filter(total>50) %>%
  pivot_longer(c(member, casual)) %>%
  ggplot(aes(x=ym, y=value, fill = name)) +
  geom_col() + 
  facet_wrap(~start_station_id) +
  theme_bw() +
  theme(axis.text.x = element_text(angle=90, size=6),
        legend.position = 'top') +
  labs(x = 'Year-month', y='Frequency of riders',
       title = 'Distribution of riders based on their membership status in origin stations\nwith >50 monthly rides') 

ggsave('fig_route_origin_year.png', height=6, width=8)

set.seed(123)
tripdata %>%
  slice_sample(n=150000) %>%
  drop_na() %>%
  mutate(date = lubridate::as_date(started_at),
         ym = str_extract(date, pattern = '^[0-9]{4}-[0-9]{2}')) %>%
  count(end_station_id, member_casual, ym) %>%
  pivot_wider(names_from = member_casual, values_from = n, values_fill = 0) %>%
  mutate(total = casual+member) %>% 
  filter(total>50) %>%
  pivot_longer(c(member, casual)) %>%
  ggplot(aes(x=ym, y=value, fill = name)) +
  geom_col() + 
  facet_wrap(~end_station_id) +
  theme_bw() +
  theme(axis.text.x = element_text(angle=90, size=6),
        legend.position = 'top') + 
  labs(x = 'Year-month', y='Frequency of riders',
       title = 'Distribution of riders based on their membership status in destination stations\nwith >50 monthly rides') 
"
"0",""
"0","ggsave('fig_route_dest_year.png', height=6, width=8)"
